<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>E-Dergi G√∂r√ºnt√ºleyici</title>

    <!-- PDF.js for rendering PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <!-- Turn.js for flipbook effect -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Arka Plan */
        .background-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-image: url('assets/manzara.png');
            background-repeat: no-repeat;
            background-position: center center;
            background-size: cover;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }

        /* Flipbook Container - Kitap G√∂r√ºn√ºm√º */
        #flipbook-container {
            perspective: 2500px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #flipbook {
            background: transparent;
            box-shadow:
                0 10px 20px rgba(0, 0, 0, 0.2),
                0 0 5px rgba(0, 0, 0, 0.1);
        }

        #flipbook .page {
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        #flipbook .page canvas {
            width: 100% !important;
            height: 100% !important;
            object-fit: fill;
        }

        /* Navigation Arrows - B√ºy√ºk ve Belirgin */
        .nav-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.4);
            color: white;
            border: none;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .nav-arrow:hover {
            background: rgba(0, 0, 0, 0.6);
            transform: translateY(-50%) scale(1.1);
        }

        .nav-arrow.prev {
            left: 15px;
        }

        .nav-arrow.next {
            right: 15px;
        }

        /* Footer Controls - Referans Tasarƒ±ma Uygun */
        .footer {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(40, 40, 40, 0.85);
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 5px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            z-index: 100;
        }

        .footer-btn {
            background: transparent;
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .footer-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .footer-divider {
            width: 1px;
            height: 25px;
            background: rgba(255, 255, 255, 0.2);
            margin: 0 5px;
        }

        .page-indicator {
            color: white;
            padding: 5px 12px;
            font-size: 13px;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .view-label {
            color: white;
            font-size: 12px;
            font-weight: 500;
            padding: 4px 8px;
            background: rgba(74, 144, 217, 0.3);
            border-radius: 4px;
        }

        .view-toggle {
            background: rgba(74, 144, 217, 0.2) !important;
        }

        .view-toggle:hover {
            background: rgba(74, 144, 217, 0.4) !important;
        }

        /* Loading */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(20, 20, 20, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading.hidden {
            display: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top-color: #4A90D9;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            color: white;
            margin-top: 20px;
            font-size: 16px;
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            body {
                background: #1a1a1a;
            }

            .background-layer {
                opacity: 0.3;
            }

            .main-content {
                padding: 5px;
                padding-bottom: 75px;
                padding-top: 5px;
            }

            #flipbook-container {
                width: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            #flipbook {
                box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
                border-radius: 4px;
            }

            #flipbook .page {
                background: white;
            }

            /* Ok butonlarƒ±nƒ± kitabƒ±n √ºzerine yerle≈ütir */
            .nav-arrow {
                width: 44px;
                height: 44px;
                font-size: 20px;
                background: rgba(0, 0, 0, 0.5);
                border: 2px solid rgba(255, 255, 255, 0.3);
            }

            .nav-arrow.prev {
                left: 10px;
            }

            .nav-arrow.next {
                right: 10px;
            }

            /* Footer d√ºzenleme */
            .footer {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                transform: none;
                border-radius: 0;
                padding: 12px 20px;
                gap: 12px;
                background: rgba(30, 30, 30, 0.98);
                justify-content: center;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }

            .footer-btn {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }

            .footer-divider {
                height: 20px;
                margin: 0 8px;
            }

            .page-indicator {
                font-size: 15px;
                padding: 8px 16px;
                font-weight: 600;
            }

            /* Mobilde g√∂r√ºn√ºm deƒüi≈ütirme butonu Gƒ∞ZLƒ∞ olsun */
            .view-toggle {
                display: none !important;
            }

            .view-label {
                display: none !important;
            }
        }
    </style>
</head>

<body>
    <!-- Arka Plan -->
    <div class="background-layer"></div>

    <!-- Loading -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p class="loading-text">PDF y√ºkleniyor...</p>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <button class="nav-arrow prev" onclick="prevPage()">‚ùÆ</button>

        <div id="flipbook-container">
            <div id="flipbook"></div>
        </div>

        <button class="nav-arrow next" onclick="nextPage()">‚ùØ</button>
    </main>

    <!-- Footer Controls -->
    <footer class="footer">
        <button class="footer-btn" onclick="firstPage()" title="ƒ∞lk Sayfa">‚èÆ</button>
        <button class="footer-btn" onclick="prevPage()" title="√ñnceki">‚óÄ</button>
        <div class="footer-divider"></div>
        <button class="footer-btn view-toggle" onclick="toggleViewMode()" title="G√∂r√ºn√ºm Deƒüi≈ütir"
            id="viewToggleBtn">üìñ</button>
        <span class="view-label" id="viewLabel">√áift Sayfa</span>
        <div class="footer-divider"></div>
        <button class="footer-btn" onclick="toggleFullscreen()" title="Tam Ekran">‚õ∂</button>
        <div class="footer-divider"></div>
        <span class="page-indicator" id="page-indicator">1-2/64</span>
        <div class="footer-divider"></div>
        <button class="footer-btn" onclick="nextPage()" title="Sonraki">‚ñ∂</button>
        <button class="footer-btn" onclick="lastPage()" title="Son Sayfa">‚è≠</button>
    </footer>

    <script>
        // PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let pdfDoc = null;
        let totalPages = 0;
        let currentPage = 1;

        // URL'den PDF dosyasƒ±nƒ± al
        const urlParams = new URLSearchParams(window.location.search);
        const pdfUrl = urlParams.get('pdf') || 'assets/pdfs/DERS 8.pdf';
        const title = urlParams.get('title') || 'E-Dergi';

        document.title = title + ' - E-Dergi G√∂r√ºnt√ºleyici';

        // Ekran boyutuna g√∂re flipbook boyutunu hesapla
        function calculateSize() {
            const container = document.querySelector('.main-content');
            const containerWidth = container.clientWidth - 10;
            const containerHeight = container.clientHeight - 70;

            const isMobile = window.innerWidth <= 768;

            let width, height;

            if (isMobile) {
                // Mobilde HER ZAMAN tek sayfa modunu zorla
                if (!isSinglePage) {
                    isSinglePage = true;
                }

                // Ekranƒ±n %95'ini kullan - maksimum okunabilirlik
                const maxWidth = containerWidth * 0.95;
                const maxHeight = containerHeight * 0.95;

                // A4 oranƒ±nƒ± koru (1:1.414)
                // √ñnce y√ºksekliƒüe g√∂re hesapla
                height = maxHeight;
                width = height * 0.707;

                // Geni≈ülik sƒ±ƒümƒ±yorsa, geni≈üliƒüe g√∂re ayarla
                if (width > maxWidth) {
                    width = maxWidth;
                    height = width * 1.414;
                }
            } else if (isSinglePage) {
                // Masa√ºst√º Tek Sayfa: Y√ºksekliƒüe tam sƒ±ƒüacak ≈üekilde
                height = Math.min(containerHeight, window.innerHeight * 0.92);
                width = height * 0.707; // A4 oranƒ±
            } else {
                // Masa√ºst√º √áift Sayfa: Geni≈ü
                height = Math.min(containerHeight, window.innerHeight * 0.92);
                width = height * 1.414;
            }

            return { width, height, isMobile };
        }

        // PDF'i y√ºkle
        async function loadPDF() {
            try {
                pdfDoc = await pdfjsLib.getDocument(pdfUrl).promise;
                totalPages = pdfDoc.numPages;

                const size = calculateSize();
                await renderAllPages(size);
                initFlipbook(size);

                document.getElementById('loading').classList.add('hidden');

            } catch (error) {
                console.error('PDF y√ºkleme hatasƒ±:', error);
                document.querySelector('.loading-text').textContent =
                    'PDF y√ºklenemedi: ' + error.message;
            }
        }

        // Sayfalarƒ± render et
        async function renderAllPages(size) {
            const flipbook = document.getElementById('flipbook');
            flipbook.innerHTML = '';

            const firstPage = await pdfDoc.getPage(1);
            const originalViewport = firstPage.getViewport({ scale: 1 });

            // Mobilde tek sayfa modunda tam geni≈ülik kullan
            const pageWidth = (size.isMobile || isSinglePage) ? size.width : size.width / 2;
            // Mobilde √ßok daha y√ºksek kalite - 4x multiplier ile kristal netlikte g√∂r√ºnt√º
            const qualityMultiplier = size.isMobile ? 4 : Math.min(window.devicePixelRatio || 2, 2.5);
            const displayScale = pageWidth / originalViewport.width;
            const renderScale = displayScale * qualityMultiplier;

            for (let i = 1; i <= totalPages; i++) {
                const page = await pdfDoc.getPage(i);
                const viewport = page.getViewport({ scale: renderScale });
                const displayViewport = page.getViewport({ scale: displayScale });

                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');

                canvas.width = viewport.width;
                canvas.height = viewport.height;
                canvas.style.width = displayViewport.width + 'px';
                canvas.style.height = displayViewport.height + 'px';

                await page.render({
                    canvasContext: context,
                    viewport: viewport
                }).promise;

                const pageDiv = document.createElement('div');
                pageDiv.className = 'page';
                pageDiv.appendChild(canvas);
                flipbook.appendChild(pageDiv);
            }
        }

        // Turn.js ba≈ülat
        function initFlipbook(size) {
            const isMobile = window.innerWidth <= 768;

            // Mobilde varsayƒ±lan olarak tek sayfa
            if (isMobile) {
                isSinglePage = true;
            }

            $('#flipbook').turn({
                width: size.width,
                height: size.height,
                autoCenter: true,
                display: isSinglePage ? 'single' : 'double',
                acceleration: true,
                gradients: true,
                elevation: 50,
                duration: 400,
                when: {
                    turned: function (event, page) {
                        currentPage = page;
                        updatePageIndicator();
                    }
                }
            });

            updatePageIndicator();
        }

        // Sayfa g√∂stergesini g√ºncelle
        function updatePageIndicator() {
            const isMobile = window.innerWidth <= 768;

            // Eƒüer mobildeyse VEYA tek sayfa modundaysa (Masa√ºst√º dahil)
            if (isMobile || isSinglePage) {
                document.getElementById('page-indicator').textContent =
                    `${currentPage}/${totalPages}`;
            } else {
                // √áift sayfa g√∂r√ºn√ºm√º
                const rightPage = Math.min(currentPage + 1, totalPages);
                document.getElementById('page-indicator').textContent =
                    `${currentPage}-${rightPage}/${totalPages}`;
            }
        }

        // Navigasyon
        function nextPage() { $('#flipbook').turn('next'); }
        function prevPage() { $('#flipbook').turn('previous'); }
        function firstPage() { $('#flipbook').turn('page', 1); }
        function lastPage() { $('#flipbook').turn('page', totalPages); }

        // Mobilde varsayƒ±lan olarak tek sayfa - daha okunabilir
        let isSinglePage = window.innerWidth <= 768 ? true : false;

        // G√∂r√ºn√ºm Modu Deƒüi≈ütir (Tek Sayfa / √áift Sayfa)
        function toggleViewMode() {
            // Mobilde deƒüi≈ütirmeye izin verme
            if (window.innerWidth <= 768) return;

            isSinglePage = !isSinglePage;

            // Mevcut sayfayƒ± kaydet
            const currentPageNum = $('#flipbook').turn('page');

            // Display modunu deƒüi≈ütir
            const displayMode = isSinglePage ? 'single' : 'double';
            $('#flipbook').turn('display', displayMode);

            // Yeni boyutlarƒ± hesapla ve uygula
            const size = calculateSize();
            $('#flipbook').turn('size', size.width, size.height);

            // Sayfaya geri d√∂n
            $('#flipbook').turn('page', currentPageNum);

            // UI g√ºncelle
            document.getElementById('viewToggleBtn').textContent = isSinglePage ? 'üìÑ' : 'üìñ';
            document.getElementById('viewLabel').textContent = isSinglePage ? 'Tek Sayfa' : '√áift Sayfa';

            updatePageIndicator();
        }

        // Tam Ekran
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // Klavye
        document.addEventListener('keydown', function (e) {
            if (e.key === 'ArrowRight') nextPage();
            if (e.key === 'ArrowLeft') prevPage();
            if (e.key === 'Home') firstPage();
            if (e.key === 'End') lastPage();
            if (e.key === 'f' || e.key === 'F') toggleFullscreen();
        });

        // Touch/Swipe
        let touchStartX = 0;
        document.addEventListener('touchstart', (e) => { touchStartX = e.touches[0].clientX; }, { passive: true });
        document.addEventListener('touchend', (e) => {
            const diff = touchStartX - e.changedTouches[0].clientX;
            if (Math.abs(diff) > 50) diff > 0 ? nextPage() : prevPage();
        }, { passive: true });

        // Resize Handler - Ekran boyutu deƒüi≈üince
        window.addEventListener('resize', function () {
            const isMobile = window.innerWidth <= 768;

            // Eƒüer mobildeyse ve ≈üu an √ßift sayfa modundaysa -> TEK SAYFAYA ZORLA
            if (isMobile && !isSinglePage) {
                isSinglePage = true;
                $('#flipbook').turn('display', 'single');
                // Sayfa numarasƒ±nƒ± koru (gerekirse √ßift sayfadan teke d√º≈üerken ayarlama turn.js tarafƒ±ndan yapƒ±lƒ±r)
            }
            // ƒ∞sterseniz: Masa√ºst√ºne ge√ßince √ßift sayfaya d√∂ns√ºn m√º? 
            // Kullanƒ±cƒ± sadece "mobile ge√ßince tek olsun" dedi, tersini demedi ama genelde beklenir.
            // ≈ûimdilik sadece mobile ge√ßi≈üi zorlayalƒ±m, masa√ºst√º serbest kalsƒ±n.

            // Boyutlarƒ± g√ºncelle
            const size = calculateSize();
            $('#flipbook').turn('size', size.width, size.height);

            updatePageIndicator();
        });

        // Y√ºkle
        loadPDF();
    </script>
</body>

</html>